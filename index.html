<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å°å—æµªæ¼«å†’éšªè§£é–</title>
<meta name="description" content="é€™ä¸æ˜¯æ™®é€šçš„æ—…è¡Œï¼Œè€Œæ˜¯å°ˆå±¬å¦³çš„å†’éšªã€‚">
<style>
  :root{
    /* è‰²å½©ï¼ˆæ—¥ç³»éœ§é¢ï¼‰ */
    --cream:#F7F4EF;         /* å¥¶æ²¹ç±³ç™½ */
    --mist:#8FB8A8;          /* éœ§æ¹–ç¶  */
    --wood:#9C7E68;          /* æœ¨è³ªæ£• */
    --ink:#333;              /* å¢¨é»‘ */
    --muted:#6b6b6b;

    --card:#FFFFFF;
    --ring:rgba(143,184,168,.35);

    /* å…ƒä»¶ */
    --radius:18px;
    --shadow:0 10px 24px rgba(0,0,0,.08);
    --shadow-soft:0 6px 18px rgba(0,0,0,.06);
    --focus:0 0 0 3px var(--ring);
    --tap:translateY(1px) scale(.99);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--ink);
    background:
      radial-gradient(1000px 700px at 100% -10%, #e8efe9 0%, rgba(232,239,233,0) 55%),
      radial-gradient(800px 600px at -10% 20%, #f1eee9 0%, rgba(241,238,233,0) 55%),
      var(--cream);
  }

  .wrap{max-width:720px;margin:0 auto;padding:16px 16px 28px}

  header{
    display:flex;gap:12px;align-items:center;justify-content:flex-start;
    padding:8px 4px 12px;
  }
  .sticker{
    width:44px;height:44px;border-radius:12px;flex:0 0 auto;
    display:grid;place-items:center;
    background: conic-gradient(from 210deg at 50% 50%, #bcd6c9, #f4ede6);
    box-shadow: var(--shadow-soft);
    position:relative; overflow:hidden;
  }
  .sticker::after{
    content:"âœ¦"; font-size:18px; color:#557a6a;
  }
  h1{font-size:22px;margin:0 0 2px 0;letter-spacing:.5px}
  .subtitle{color:var(--muted);font-size:13px;margin:0}

  /* é€²åº¦æ¢ */
  .progress{
    display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:12px 2px 18px;
  }
  .step{
    height:8px;border-radius:999px;background:#E5E7E9;position:relative;overflow:hidden;
  }
  .step[data-active="true"]{background:#dfe8e3}
  .step > i{
    position:absolute;inset:0;width:0%;background:linear-gradient(90deg,#b6d2c3,#8FB8A8);
    transition:width .3s ease;
  }

  /* å¡ç‰‡å®¹å™¨ */
  .card{
    background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;
    animation:fadeIn .25s ease;
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

  /* é¸é …æ ¼ï¼ˆæ‰‹æ©Ÿè‡ªå‹•æ›è¡Œï¼‰ */
  .grid{display:flex;flex-wrap:wrap;gap:10px}
  .chip{
    appearance:none;border:none;background:#fff;border:1px solid #eceaea;
    padding:12px 14px;border-radius:14px;cursor:pointer;
    box-shadow:0 2px 0 rgba(0,0,0,.03);
    transition:.15s;
    font-size:15px; line-height:1;
  }
  .chip:active{transform:var(--tap)}
  .chip[data-selected="true"]{
    background:linear-gradient(180deg,#fff,#f2f7f4);
    border-color:#dfe9e4; box-shadow:0 8px 16px var(--ring);
    color:#365a4b;
  }
  .chip[aria-pressed="true"]{outline:var(--focus)}

  /* æŒ‰éˆ• */
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:14px 16px;border-radius:16px;border:1px solid transparent;cursor:pointer;
    font-weight:600; letter-spacing:.3px; min-height:48px; width:100%;
    transition:.15s; user-select:none;
  }
  .btn:active{transform:var(--tap)}
  .btn.primary{background:linear-gradient(180deg,#a8cbbb,#8FB8A8); color:#0f3025; box-shadow:0 12px 24px var(--ring)}
  .btn.ghost{background:#fff;border-color:#e8e3dd;color:#6a5a4f}
  .btn.wood{background:linear-gradient(180deg,#b4957f,#9C7E68);color:#fff}
  .btn.row{display:flex}
  .btn.icon{width:48px;padding:0}

  .row{display:flex;gap:10px;align-items:center}
  .space{height:12px}

  /* æ·¡æç¤º */
  .hint{font-size:13px;color:#566b62;background:#f4f8f6;border:1px dashed #d7e6df;padding:10px;border-radius:12px}

  /* çµæœå¡ */
  .result-line{margin:6px 0}
  .quote{
    background:#fffdf7;border:1px solid #f0e8d9;color:#6b4f2e;border-radius:14px;padding:12px;margin-top:8px
  }
  .heart{
    width:54px;height:54px;border-radius:50%;display:grid;place-items:center;cursor:pointer;margin:4px auto 0;
    background:#fff; border:1px solid #e8e3dd; box-shadow:var(--shadow-soft);
    transition:.15s;
  }
  .heart:active{transform:var(--tap)}
  .heart[data-on="true"]{background:#ffe9ed;border-color:#ffd1da}
  .toast{
    position:fixed;left:50%;bottom:24px;transform:translateX(-50%);
    background:#1f1f1f;color:#fff;padding:10px 14px;border-radius:12px;
    box-shadow:0 14px 28px rgba(0,0,0,.28);opacity:0;transition:.2s;z-index:9999;font-size:13px
  }

  /* ç„¡éšœç¤™ */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  /* RWD */
  @media(min-width:560px){
    h1{font-size:24px}
  }

</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="å°å—æµªæ¼«å†’éšªè§£é–äº’å‹•é ">
    <header>
      <div class="sticker" aria-hidden="true"></div>
      <div>
        <h1>å°å—æµªæ¼«å†’éšªè§£é–</h1>
        <p class="subtitle">é€™ä¸æ˜¯æ™®é€šçš„æ—…è¡Œï¼Œè€Œæ˜¯å°ˆå±¬å¦³çš„å†’éšªã€‚</p>
      </div>
    </header>

    <!-- é€²åº¦æ¢ï¼ˆé–‹å ´ä¸ç®—ï¼Œå…± 4 æ®µï¼‰ -->
    <div class="progress" aria-label="é€²åº¦æŒ‡ç¤º" aria-live="polite">
      <div class="step" data-step="1" aria-hidden="true"><i></i></div>
      <div class="step" data-step="2" aria-hidden="true"><i></i></div>
      <div class="step" data-step="3" aria-hidden="true"><i></i></div>
      <div class="step" data-step="4" aria-hidden="true"><i></i></div>
    </div>

    <!-- å¡ç‰‡å®¹å™¨ -->
    <main id="panel" class="card" tabindex="-1" aria-live="polite">
      <!-- 0. é–‹å ´å¡ -->
      <section data-screen="welcome">
        <h2 class="sr-only">é–‹å ´</h2>
        <div class="hint" style="margin-bottom:10px">
          æ—¥è¨˜æœ¬ç¿»é–‹çš„ä¸€å¤©ï¼šå¦³åšçš„æ¯ä¸€å€‹å°é¸æ“‡ï¼Œéƒ½æœƒæ‚„æ‚„æ”¹è®Šæˆ‘å€‘çš„è·¯ç·šã€‚æ²’æœ‰æ­£ç¢ºç­”æ¡ˆï¼Œåªæœ‰æƒ³è¢«å¦³ç™¼ç¾çš„é¢¨æ™¯ã€‚
        </div>
        <p style="margin:10px 0 16px">å› ç‚ºæœ‰å¦³ï¼Œå°å—æ‰æœƒè®Šå¾—ä¸ä¸€æ¨£ã€‚</p>
        <button class="btn primary" data-action="start">é–‹å§‹è§£é–</button>
      </section>

      <!-- 1. ä¸»é¡Œé¸æ“‡ -->
      <section data-screen="step1" hidden>
        <h2 style="margin:0 0 6px">ä»Šå¤©æœ€æƒ³å±•é–‹çš„æ–‡é’å ´æ™¯æ˜¯ï¼Ÿ</h2>
        <div class="grid" role="group" aria-label="æ–‡é’å ´æ™¯é¸æ“‡">
          <button class="chip" data-value="å¥‡ç¾åšç‰©é¤¨ ğŸ¨ï¼ˆå±•è¦½ï¼‹è—è¡“ï¼‹æ‹ç…§ï¼‰">A. å¥‡ç¾åšç‰©é¤¨ ğŸ¨</button>
          <button class="chip" data-value="å­”å»Ÿè€è¡— ğŸ®ï¼ˆæ­·å²æ°›åœï¼‹ç‰¹è‰²å°åº—ï¼‰">B. å­”å»Ÿè€è¡— ğŸ®</button>
          <button class="chip" data-value="åé¼“ç³–å»  ğŸŒ™ï¼ˆå·¥æ¥­éºè·¡ï¼‹å¤œé–“ç‡ˆå…‰ï¼‰">C. åé¼“ç³–å»  ğŸŒ™</button>
          <button class="chip" data-value="äº¤çµ¦ä½ å®‰æ’ ğŸ">äº¤çµ¦ä½ å®‰æ’ ğŸ</button>
        </div>
        <div class="space"></div>
        <p id="fb1" class="hint" aria-live="polite" style="display:none"></p>
        <div class="space"></div>
        <div class="row">
          <button class="btn ghost" data-skip="1" aria-label="è·³éæ­¤æ­¥é©Ÿ">è·³é</button>
          <button class="btn primary" data-next="1" disabled>ä¸‹ä¸€æ­¥</button>
        </div>
      </section>

      <!-- 2. é£Ÿç‰© / é£²å“åå¥½ -->
      <section data-screen="step2" hidden>
        <h2 style="margin:0 0 6px">æ—…ç¨‹è£¡ï¼Œå¦³æœ€æƒ³æŠŠå“ªå€‹å‘³é“å¯«é€²ä»Šå¤©ï¼Ÿ</h2>
        <div class="grid" role="group" aria-label="é£Ÿç‰©èˆ‡é£²å“åå¥½">
          <button class="chip" data-value="å°å—å°åƒ ğŸœï¼ˆç‰›è‚‰æ¹¯/æ“”ä»”éºµ/æ£ºææ¿ï¼‰">A. å°å—å°åƒ ğŸœ</button>
          <button class="chip" data-value="è€å’–å•¡å»³ â˜•ï¼ˆè€å®…çš„æ‰‹æ²–èˆ‡æœ¨è³ªé¦™ï¼‰">B. è€å’–å•¡å»³ â˜•</button>
          <button class="chip" data-value="ç”œé»æˆ–å†°å“ ğŸ§ï¼ˆå¯æ„›ç™‚ç™’ä¸€ä¸‹ï¼‰">C. ç”œé»æˆ–å†°å“ ğŸ§</button>
          <button class="chip" data-value="äº¤çµ¦ä½ å®‰æ’ ğŸï¼ˆæˆ‘æƒ³è¦é©šå–œï¼‰">D. äº¤çµ¦ä½ å®‰æ’ ğŸ</button>
        </div>
        <div class="space"></div>
        <p id="fb2" class="hint" aria-live="polite" style="display:none"></p>
        <div class="space"></div>
        <div class="row">
          <button class="btn ghost" data-back="2">ä¸Šä¸€æ­¥</button>
          <button class="btn wood" data-random="2" aria-label="éš¨æ©Ÿå°é©šå–œ">éš¨æ©Ÿé¸æ“‡</button>
          <button class="btn primary" data-next="2" disabled>ä¸‹ä¸€æ­¥</button>
        </div>
      </section>

      <!-- 3. å’–å•¡å»³æ°›åœ -->
      <section data-screen="step3" hidden>
        <h2 style="margin:0 0 6px">ä¼‘æ¯çš„æ™‚å€™ï¼Œæˆ‘å€‘è¦ååœ¨å“ªå€‹è§’è½ï¼Ÿ</h2>
        <div class="grid" role="group" aria-label="å’–å•¡å»³æ°›åœ">
          <button class="chip" data-value="KKOBA Apartmentï¼ˆæ–‡é’ç°¡ç´„ã€å®‰éœèŠå¤©ï¼‰">A. KKOBA Apartment</button>
          <button class="chip" data-value="è‰æœ¨æ£®èŠ±ï¼ˆè€å®…ï¼‹èŠ±è—æ„Ÿï¼‰">B. è‰æœ¨æ£®èŠ±</button>
          <button class="chip" data-value="é¹½åŸ•è€å’–å•¡å»³ç¾¤ï¼ˆéš¨æ©ŸæŒ‘ä¸€å®¶ï¼‰">C. é¹½åŸ•è€å’–å•¡å»³ç¾¤</button>
          <button class="chip" data-value="å¯æ„›ç”œé»é¢¨å’–å•¡ï¼ˆç¹½ç´›ç™‚ç™’ï¼‰">D. å¯æ„›ç”œé»é¢¨å’–å•¡</button>
          <button class="chip" data-value="äº¤çµ¦ä½ å®‰æ’ï¼ˆæƒ³çœ‹ä½ çš„å°ä»»æ€§ï¼‰">E. äº¤çµ¦ä½ å®‰æ’</button>
        </div>
        <div class="space"></div>
        <p id="fb3" class="hint" aria-live="polite" style="display:none"></p>
        <div class="space"></div>
        <div class="row">
          <button class="btn ghost" data-back="3">ä¸Šä¸€æ­¥</button>
          <button class="btn wood" data-random="3">éš¨æ©Ÿé¸æ“‡</button>
          <button class="btn primary" data-next="3" disabled>å‰å¾€å½©è›‹</button>
        </div>
      </section>

      <!-- 4. ï¼ˆå¯é¸ï¼‰æµªæ¼«æ”¶å°¾å½©è›‹ -->
      <section data-screen="step4" hidden>
        <h2 style="margin:0 0 6px">ä»Šå¤©çš„ç•«é¢ï¼Œè¦æ€éº¼ç•™ï¼Ÿ</h2>
        <div class="grid" role="group" aria-label="æµªæ¼«æ”¶å°¾">
          <button class="chip" data-value="é¢¨æ™¯ç…§ ğŸŒ†">A. é¢¨æ™¯ç…§ ğŸŒ†</button>
          <button class="chip" data-value="æˆ‘å€‘çš„åˆç…§ ğŸ“¸">B. æˆ‘å€‘çš„åˆç…§ ğŸ“¸</button>
          <button class="chip" data-value="åªæœ‰æˆ‘å€‘æ‡‚çš„ç§å¯†ç•«é¢ ğŸ’Œ">C. ç§å¯†ç•«é¢ ğŸ’Œ</button>
          <button class="chip" data-value="é‡è¦‹äº†å†èªª">D. å…ˆä¸æƒ³ï¼Œé‡è¦‹äº†å†èªª</button>
        </div>
        <div class="space"></div>
        <p id="fb4" class="hint" aria-live="polite" style="display:none"></p>
        <div class="space"></div>
        <div class="row">
          <button class="btn ghost" data-back="4">ä¸Šä¸€æ­¥</button>
          <button class="btn primary" data-finish>å®Œæˆè§£é–</button>
        </div>
      </section>

      <!-- 5. çµæœå¡ -->
      <section data-screen="result" hidden>
        <h2 style="margin:0 0 6px">è§£é–å®Œæˆï¼ä»Šå¤©çš„å°å—ï¼Œå› å¦³è€Œå®šç¾©</h2>
        <div id="summary" class="quote" aria-live="polite">
          <!-- å‹•æ…‹æ‘˜è¦å¡«å…¥ -->
        </div>
        <div class="space"></div>
        <div class="heart" role="button" aria-label="é»æ“Šæ„›å¿ƒ" tabindex="0"><span aria-hidden="true">â¤</span></div>
        <p style="text-align:center;color:var(--muted);font-size:13px">é»æ„›å¿ƒçœ‹çœ‹</p>
        <div class="space"></div>
        <div class="row">
          <button class="btn wood" id="share">åˆ†äº«æ–‡å­—</button>
          <button class="btn ghost" id="copy">è¤‡è£½å…¨æ–‡</button>
        </div>
        <div class="space"></div>
        <button class="btn primary" id="restart">å†ç©ä¸€æ¬¡</button>
      </section>
    </main>
  </div>

  <script>
    // ====== æ–‡æ¡ˆæ± ï¼ˆå›é¥‹ï¼‰ ======
    const feedbacks = {
      step1: [
        "é‚£è£¡çš„å…‰å½±ï¼Œæœƒå¾ˆé©åˆå¦³çš„ç¬‘å®¹ã€‚",
        "æ™‚é–“æ…¢ä¸‹ä¾†ï¼Œæ­£å¥½è®“æˆ‘å¤šçœ‹å¦³ä¸€çœ¼ã€‚",
        "åœ¨ç‡ˆå…‰ä¸‹ï¼Œæˆ‘æƒ³å’Œå¦³é è¿‘ä¸€é»ã€‚"
      ],
      step2: [
        "å°å—çš„æ—¥å¸¸ï¼ŒåŠ ä¸Šå¦³ï¼Œå°±è®Šæˆç¨ä¸€ç„¡äºŒçš„å‘³é“ã€‚",
        "è€å®…è£¡çš„æº«åº¦ï¼Œä¸å¦‚å¦³çš„ä¸€å¥è©±æš–ã€‚",
        "ç”œé»å¯ä»¥åƒï¼Œä½†æœ€ç”œçš„æ˜¯é€™è¶Ÿæ—…ç¨‹ã€‚",
        "é©šå–œæº–å‚™å¥½ï¼Œå°±ç­‰å¦³çš„ç¬‘å®¹ä¾†æ­æ›‰ã€‚"
      ],
      step3: [
        "é‚£å°±æŠŠä¸‹åˆå…‰ï¼Œç•™åœ¨æ¯ç·£ä¸Šã€‚",
        "èŠ±é–‹åœ¨æ¡Œä¸Šï¼Œæº«æŸ”åœ¨å¿ƒè£¡ã€‚",
        "å°‹æ‰¾åªå±¬æ–¼ä»Šå¤©çš„å°ç¢ºå¹¸ã€‚",
        "å¯æ„›ï¼Œæ˜¯ä»Šå¤©çš„é—œéµå­—ã€‚",
        "äº†è§£ï¼Œæˆ‘æœƒæŠŠå¦³çš„ç¬‘å®¹æ”¾é€²åº§ä½è¡¨ã€‚"
      ],
      step4: [
        "é€™å…‰å¥½åƒåœ¨ç­‰æˆ‘å€‘ã€‚",
        "é‚£äº›åªå±¬æ–¼æˆ‘å€‘çš„ç¬é–“ï¼Œæˆ‘æœƒå°å¿ƒæ”¶è—ã€‚"
      ]
    };

    // ====== ç‹€æ…‹å„²å­˜ ======
    const state = { step: 0, picks: {} };

    // ====== å…ƒç´ å¿«å– ======
    const panel = document.getElementById('panel');
    const stepsBars = [...document.querySelectorAll('.step')];

    // ====== å·¥å…· ======
    const rand = arr => arr[Math.floor(Math.random()*arr.length)];
    const showToast = (msg)=>{
      const t = document.createElement('div');
      t.className = 'toast'; t.textContent = msg;
      document.body.appendChild(t);
      requestAnimationFrame(()=>t.style.opacity='1');
      setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=>t.remove(), 180)}, 1400);
    };

    function setProgress(toIndex){
      // toIndex: 1..4
      stepsBars.forEach((bar,i)=>{
        const idx = i+1;
        const fill = bar.querySelector('i');
        if(idx < toIndex){ bar.dataset.active="true"; fill.style.width = "100%"; }
        else if(idx === toIndex){ bar.dataset.active="true"; fill.style.width="50%"; }
        else { bar.dataset.active="false"; fill.style.width="0%"; }
      });
    }

    function switchScreen(name){
      [...panel.children].forEach(sec=>{
        if(sec.dataset && sec.dataset.screen){
          sec.hidden = sec.dataset.screen !== name;
        }
      });
      panel.focus();
    }

    function selectChip(groupSection, chip){
      // å–®é¸ï¼Œæ¸…å…¶ä»–
      groupSection.querySelectorAll('.chip').forEach(c=>c.dataset.selected="false");
      chip.dataset.selected="true";
    }

    function getSelectedValue(section){
      const chip = section.querySelector('.chip[data-selected="true"]');
      return chip ? chip.dataset.value : "";
    }

    function enableNext(section, enabled){
      const btn = section.querySelector('[data-next]');
      if(btn) btn.disabled = !enabled;
    }

    // ====== ç¶å®šäº‹ä»¶ï¼šé–‹å ´ ======
    panel.querySelector('[data-action="start"]').addEventListener('click', ()=>{
      state.step = 1;
      switchScreen('step1');
      setProgress(1);
    });

    // ====== Step1 ç¶å®š ======
    (function(){
      const sec = panel.querySelector('[data-screen="step1"]');
      const chips = sec.querySelectorAll('.chip');
      const fb = document.getElementById('fb1');

      chips.forEach(ch=>{
        ch.addEventListener('click', ()=>{
          selectChip(sec, ch);
          enableNext(sec, true);
          fb.style.display = 'block';
          fb.textContent = rand(feedbacks.step1);
          state.picks.step1 = ch.dataset.value;
        });
      });
      sec.querySelector('[data-next]').addEventListener('click', ()=>{
        state.step = 2;
        switchScreen('step2'); setProgress(2);
      });
      sec.querySelector('[data-skip]').addEventListener('click', ()=>{
        state.picks.step1 = "äº¤çµ¦ä½ å®‰æ’ ğŸ";
        state.step = 2; switchScreen('step2'); setProgress(2);
      });
    })();

    // ====== Step2 ç¶å®š ======
    (function(){
      const sec = panel.querySelector('[data-screen="step2"]');
      const chips = sec.querySelectorAll('.chip');
      const fb = document.getElementById('fb2');

      chips.forEach(ch=>{
        ch.addEventListener('click', ()=>{
          selectChip(sec, ch);
          enableNext(sec, true);
          fb.style.display = 'block';
          fb.textContent = rand(feedbacks.step2);
          state.picks.step2 = ch.dataset.value;
        });
      });
      sec.querySelector('[data-next]').addEventListener('click', ()=>{
        state.step = 3; switchScreen('step3'); setProgress(3);
      });
      sec.querySelector('[data-back]').addEventListener('click', ()=>{
        state.step = 1; switchScreen('step1'); setProgress(1);
      });
      sec.querySelector('[data-random]').addEventListener('click', ()=>{
        const all = [...chips];
        const pick = all[Math.floor(Math.random()*all.length)];
        pick.click(); showToast("å·²ç‚ºå¦³æŠ½ä¸€å€‹å°é©šå–œ");
      });
    })();

    // ====== Step3 ç¶å®š ======
    (function(){
      const sec = panel.querySelector('[data-screen="step3"]');
      const chips = sec.querySelectorAll('.chip');
      const fb = document.getElementById('fb3');

      chips.forEach(ch=>{
        ch.addEventListener('click', ()=>{
          selectChip(sec, ch);
          enableNext(sec, true);
          fb.style.display = 'block';
          fb.textContent = rand(feedbacks.step3);
          state.picks.step3 = ch.dataset.value;
        });
      });
      sec.querySelector('[data-next]').addEventListener('click', ()=>{
        state.step = 4; switchScreen('step4'); setProgress(4);
      });
      sec.querySelector('[data-back]').addEventListener('click', ()=>{
        state.step = 2; switchScreen('step2'); setProgress(2);
      });
      sec.querySelector('[data-random]').addEventListener('click', ()=>{
        const all = [...chips];
        const pick = all[Math.floor(Math.random()*all.length)];
        pick.click(); showToast("å°ç¢ºå¹¸æŠ½ä¸­äº†");
      });
    })();

    // ====== Step4 ç¶å®šï¼ˆå½©è›‹å¯è·³éï¼‰ ======
    (function(){
      const sec = panel.querySelector('[data-screen="step4"]');
      const chips = sec.querySelectorAll('.chip');
      const fb = document.getElementById('fb4');

      chips.forEach(ch=>{
        ch.addEventListener('click', ()=>{
          selectChip(sec, ch);
          fb.style.display = 'block';
          fb.textContent = rand(feedbacks.step4);
          state.picks.step4 = ch.dataset.value;
        });
      });

      sec.querySelector('[data-back]').addEventListener('click', ()=>{
        state.step = 3; switchScreen('step3'); setProgress(3);
      });

      sec.querySelector('[data-finish]').addEventListener('click', ()=>{
        // è‹¥æœªé¸å½©è›‹ä¹Ÿå¯å®Œæˆ
        buildResult();
        switchScreen('result');
        setProgress(4);
      });
    })();

    // ====== çµæœå¡ ======
    function buildResult(){
      const s1 = state.picks.step1 || "äº¤çµ¦ä½ å®‰æ’ ğŸ";
      const s2 = state.picks.step2 || "äº¤çµ¦ä½ å®‰æ’ ğŸ";
      const s3 = state.picks.step3 || "äº¤çµ¦ä½ å®‰æ’";
      const s4 = state.picks.step4 ? `å°æ”¶å°¾ï¼š${state.picks.step4}` : "å°æ”¶å°¾ï¼šç•¶å¤©å†èªªã€‚";

      const lines = [
        `ç¬¬ä¸€å¹•ï¼š<b>${s1.replace(/^A\.|^B\.|^C\./,'').trim()}</b>`,
        `å‘³é“æ˜¯ï¼š<b>${s2.replace(/^A\.|^B\.|^C\./,'').trim()}</b>`,
        `ä¼‘æ¯æˆ‘å€‘å»ï¼š<b>${s3.replace(/^A\.|^B\.|^C\./,'').trim()}</b>`,
      ];

      const quote = `æ—…è¡Œæœ‰é¢¨æ™¯ã€æœ‰æ•…äº‹ï¼Œä½†æœ€ç¾çš„ç¬é–“ï¼Œå¸¸å¸¸åœ¨ä¸ç¶“æ„çš„é è¿‘ã€‚<br>
      ä¸ç®¡å»å“ªè£¡ï¼Œæˆ‘çœŸæ­£æƒ³çœ‹åˆ°çš„é¢¨æ™¯ï¼Œåªæœ‰å¦³ã€‚`;

      const el = document.getElementById('summary');
      el.innerHTML = `
        ${lines.map(l=>`<div class="result-line">${l}</div>`).join("")}
        <div class="result-line">${s4}</div>
        <div class="quote" style="margin-top:10px">${quote}</div>
      `;
      document.getElementById('copy').onclick = copySummary;
      document.getElementById('share').onclick = shareSummary;
      document.getElementById('restart').onclick = ()=>{
        state.step = 0; state.picks = {};
        // æ¸…é¸æ“‡
        document.querySelectorAll('.chip').forEach(c=>c.dataset.selected="false");
        switchScreen('welcome'); setProgress(1);
      };

      const heart = document.querySelector('.heart');
      heart.dataset.on="false";
      heart.onclick = ()=>{ toggleHeart(heart); };
      heart.onkeypress = (e)=>{ if(e.key==="Enter"||e.key===" "){toggleHeart(heart);} };
    }

    function toggleHeart(el){
      const on = el.dataset.on === "true";
      el.dataset.on = String(!on);
      showToast(!on ? "å¦³ï¼Œå°±æ˜¯æˆ‘ä»Šå¤©æœ€æƒ³è¨˜ä½çš„ç•«é¢ã€‚" : "æˆ‘æœƒå†æŠŠå–œæ­¡æ”¾å›å£è¢‹è£¡ã€‚");
    }

    async function copySummary(){
      const text = document.getElementById('summary').innerText.replace(/\n{2,}/g,"\n").trim();
      try{ await navigator.clipboard.writeText(text); showToast("å·²è¤‡è£½å…¨æ–‡"); }catch{ showToast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–"); }
    }

    async function shareSummary(){
      const text = document.getElementById('summary').innerText.replace(/\n{2,}/g,"\n").trim();
      if(navigator.share){
        try{ await navigator.share({ text }); }catch{}
      }else{
        copySummary();
      }
    }

    // åˆå§‹åŒ–ç•«é¢ï¼ˆé–‹å ´ç„¡é€²åº¦ï¼Œåƒ…äº®ç¬¬ä¸€æ®µ 0%ï¼‰
    setProgress(1);
  </script>
</body>
</html>
